customElements.define('format-input',class extends HTMLElement{constructor(){super()}connectedCallback(){this.children.length&&this._init();this._observer=new MutationObserver(this._init.bind(this));this._observer.observe(this,{childList:!0})}_init(){this._observer?.disconnect();this._observer=void 0;let a=this.dataset.format;if(!a)return;let b=this.view=this.querySelector('input');if(!b)return;let c=this.input=b.cloneNode();b.addEventListener('focus',this.edit.bind(this));b.type='text';b.removeAttribute('name');c.type='hidden';this.appendChild(c);this.addFormatter(a)}addFormatter(a,b=1){setTimeout(()=>{this.formatter=a?.split('.').reduce((acc,val)=>acc[val],window);!this.formatter?this.addFormatter(a,b*2):this.view.addEventListener('blur',this.format.bind(this))},b)}edit(){this.view.value=this.input.value}format(){let a=this.formatter.isValid(this.view.value);if(a){this.view.setCustomValidity(a);return}this.view.setCustomValidity('');this.input.value=this.view.value;this.view.value=this.formatter.format(this.input.value)}disconnectedCallback(){this.view.removeEventListener('focus',this.edit.bind(this));this.view.removeEventListener('blur',this.format.bind(this))}});
