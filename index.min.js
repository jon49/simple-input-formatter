customElements.define('format-input',class extends HTMLElement{constructor(){super()}connectedCallback(){this.children.length&&this._init();this._observer=new MutationObserver(this._init.bind(this));this._observer.observe(this,{childList:!0})}handleEvent(e){this[`on${e.type}`](e)}onfocus(){!this.view.validationMessage&&(this.view.type=this._type,this.view.value=this.input.value)}_setMessage(){let a=this.dataset.showInvalid;let b=this.view.validationMessage;a&&b?this.querySelector(a).textContent=b:a&&(this.querySelector(a).innerHTML='&nbsp;')}formatterWait=1;onblur(){this.view.setCustomValidity('');this._setMessage();if(!this.view.checkValidity()){this._setMessage();return}if(!this.formatter)return;let A=this.formatter?.isValid(this.view.value);if(A){!this.inputListener&&(this.inputListener=!0,this.view.addEventListener('input',this));this.view.setCustomValidity(A);this._setMessage();return}this.input.value=this.view.value;this.view.type='text';this.view.value=this.formatter.format(this.input.value)}onkeydown(e){e.key=='Enter'&&this.onblur()}oninput(){if(!this.formatter)return;console.log('input',this.view.value);let _=this.formatter?.isValid(this.view.value);!_&&(this.view.setCustomValidity(''),this.view.removeEventListener('input',this),this._setMessage())}_init(){this._observer?.disconnect();this._observer=void 0;let B=this.dataset.format;if(!B)return;let c=this.view=this.querySelector('input');if(!c)return;let C=this.input=c.cloneNode();c.addEventListener('focus',this);this._type=c.type;c.type='text';c.removeAttribute('name');C.type='hidden';this.appendChild(C);this.addFormatter(B)}addFormatter(_a,_b=1){this.timeoutId=setTimeout(()=>{this.formatter=_a?.split('.').reduce((acc,val)=>acc[val],window);!this.formatter?this.addFormatter(_a,_b*2):this.view.addEventListener('blur',this)},_b)}disconnectedCallback(){this.timeoutId&&clearTimeout(this.timeoutId)}});
